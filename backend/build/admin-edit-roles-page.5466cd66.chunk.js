(self.webpackChunkcorporate_blog_template=self.webpackChunkcorporate_blog_template||[]).push([[2544],{4644:(G,F,r)=>{"use strict";r.d(F,{V:()=>$});var e=r(30422),b=r(88767);const $=(C={},L={})=>{const{id:S,...v}=C,{get:R}=(0,e.kY)();if(!S&&(L?.enabled===void 0||L?.enabled))throw new Error('"id" is a required argument');const{data:k,error:Q,isError:i,isLoading:I,refetch:E}=(0,b.useQuery)(["roles",S,"permissions",v],async()=>{const{data:{data:ae}}=await R(`/admin/roles/${S}/permissions`,{params:v});return ae},L);return{permissions:k,error:Q,isError:i,isLoading:I,refetch:E}}},51754:(G,F,r)=>{"use strict";r.d(F,{F:()=>C});var e=r(30422),b=r(86896),$=r(88767);const C=(L={},S={})=>{const{id:v="",...R}=L,{get:k}=(0,e.kY)(),{locale:Q}=(0,b.Z)(),i=(0,e.Xe)(Q,{sensitivity:"base"}),{data:I,error:E,isError:ae,isLoading:Ce,refetch:h}=(0,$.useQuery)(["roles",v,R],async()=>{const{data:K}=await k(`/admin/roles/${v??""}`,{params:R});return K},S);let A=[];return v&&I?A=[I.data]:Array.isArray(I?.data)&&(A=I.data),{roles:A.sort((K,pe)=>i.compare(K.name,pe.name)),error:E,isError:ae,isLoading:Ce,refetch:h}}},25545:(G,F,r)=>{"use strict";r.r(F),r.d(F,{CreatePage:()=>ke,default:()=>je});var e=r(67294),b=r(185),$=r(53979),C=r(11047),L=r(29728),S=r(49066),v=r(41580),R=r(75515),k=r(11276),Q=r(67819),i=r(16364),I=r(61467),E=r(30422),ae=r(67109),Ce=r(6406),h=r(41054),A=r(41609),K=r.n(A),pe=r(86896),$e=r(86706),Ee=r(16550),T=r(71997),Le=r(4644),xe=r(36364),Y=r(442),de=r(90065),be=r(87561);const Se=be.Ry().shape({name:be.Z_().required(E.I0.required),description:be.Z_().required(E.I0.required)}),ge=T.ZP.div`
  border: 1px solid ${({theme:V})=>V.colors.primary200};
  background: ${({theme:V})=>V.colors.primary100};
  padding: ${({theme:V})=>`${V.spaces[2]} ${V.spaces[4]}`};
  color: ${({theme:V})=>V.colors.primary600};
  border-radius: ${({theme:V})=>V.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,ke=()=>{const V=(0,Ee.$B)("/settings/roles/duplicate/:id"),U=(0,E.lm)(),{lockApp:te,unlockApp:z}=(0,E.o1)(),{formatMessage:j}=(0,pe.Z)(),[q,le]=(0,e.useState)(!1),{replace:oe}=(0,Ee.k6)(),W=(0,e.useRef)(),{trackUsage:ne}=(0,E.rS)(),{post:Ie,put:Ze}=(0,E.kY)(),{params:ue}=V??{},{isLoading:Fe,data:Te}=(0,de.d)(ue?.id,{cacheTime:0}),{permissions:ce,isLoading:ve}=(0,Le.V)({id:ue?.id},{cacheTime:0,enabled:!!ue?.id}),Be=fe=>{te(),le(!0),ue?.id?ne("willDuplicateRole"):ne("willCreateNewRole"),Promise.resolve(Ie("/admin/roles",fe)).then(async({data:X})=>{const{permissionsToSend:_}=W.current.getPermissions();return ue?.id?ne("didDuplicateRole"):ne("didCreateNewRole"),X.data.id&&!K()(_)&&await Ze(`/admin/roles/${X.data.id}/permissions`,{permissions:_}),X}).then(X=>{le(!1),U({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),oe(`/settings/roles/${X.data.id}`)}).catch(X=>{console.error(X),le(!1),U({type:"warning",message:{id:"notification.error"}})}).finally(()=>{z()})},Ge=`${j({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,Ce.Z)(new Date,"PPP")}`;return e.createElement(b.o,null,e.createElement(E.SL,{name:"Roles"}),e.createElement(h.J9,{initialValues:{name:"",description:Ge},onSubmit:Be,validationSchema:Se,validateOnChange:!1},({handleSubmit:fe,values:X,errors:_,handleReset:ee,handleChange:se})=>e.createElement(E.l0,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement($.T,{primaryAction:e.createElement(C.k,{gap:2},e.createElement(L.z,{variant:"secondary",onClick:()=>{ee(),W.current.resetForm()},size:"L"},j({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(L.z,{onClick:fe,loading:q,size:"L"},j({id:"global.save",defaultMessage:"Save"}))),title:j({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:j({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(E.rU,{startIcon:e.createElement(ae.Z,null),to:"/settings/roles"},j({id:"global.back",defaultMessage:"Back"}))}),e.createElement(S.D,null,e.createElement(C.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(v.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(C.k,{justifyContent:"space-between"},e.createElement(v.x,null,e.createElement(v.x,null,e.createElement(R.Z,{fontWeight:"bold"},j({id:"global.details",defaultMessage:"Details"}))),e.createElement(v.x,null,e.createElement(R.Z,{variant:"pi",textColor:"neutral600"},j({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(ge,null,j({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(k.r,{gap:4},e.createElement(Q.P,{col:6},e.createElement(i.o,{name:"name",error:_.name&&j({id:_.name}),label:j({id:"global.name",defaultMessage:"Name"}),onChange:se,required:!0,value:X.name})),e.createElement(Q.P,{col:6},e.createElement(I.g,{label:j({id:"global.description",defaultMessage:"Description"}),id:"description",error:_.description&&j({id:_.description}),onChange:se},X.description))))),!Fe&&!ve?e.createElement(v.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Y.Z,{isFormDisabled:!1,ref:W,permissions:ce,layout:Te})):e.createElement(v.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(E.dO,null))))))))};function je(){const V=(0,$e.v9)(xe._);return e.createElement(E.O4,{permissions:V.settings.roles.create},e.createElement(ke,null))}},442:(G,F,r)=>{"use strict";r.d(F,{Z:()=>ts});var e=r(67294),b=r(82777),$=r(77296),C=r(42761),L=r(30422),S=r(18721),v=r.n(S),R=r(41609),k=r.n(R),Q=r(45697),i=r.n(Q),I=r(86896),E=r(41580),ae=r(89734),Ce=r.n(ae),h=r(71997),A=r(11047),K=r(92155),pe=r(52337),$e=r(66942),Ee=r(27361),T=r.n(Ee),Le=r(57557),xe=r.n(Le),Y=r(92807),de=r(29728),be=r(78114);const De=h.ZP.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,Se=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:a}=(0,I.Z)();return e.createElement(De,{hasConditions:o,className:n},e.createElement(de.z,{variant:s,startIcon:e.createElement(be.Z,null),onClick:t},a({id:"global.settings",defaultMessage:"Settings"})))};Se.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},Se.propTypes={onClick:i().func.isRequired,className:i().string,hasConditions:i().bool,variant:i().string};const ge=(0,h.ZP)(Se)``;var ke=r(42866),je=r(24969),V=r(59946),U=r(75515),te=r(36856),z=r(63321),j=r(36773),q=r(18172),le=r(7739),oe=r.n(le),W=r(11700),ne=r.n(W),Ie=r(38953);const Ze=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),ue=t=>t.reduce((n,[o,s])=>(n.push({label:ne()(o),children:s.map(a=>({label:a.displayName,value:a.id}))}),n),[]),Fe=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),Te=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:a,onChange:l,value:c})=>{const{formatMessage:d}=(0,I.Z)(),m=u=>{l(a,Fe(t,u))};return e.createElement(A.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(A.k,{paddingLeft:6,style:{width:180}},e.createElement(U.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(U.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(U.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(E.x,{style:{maxWidth:430,width:"100%"}},e.createElement(Ie.Q,{id:a,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:Ze(c),options:ue(t),disabled:n})))};Te.propTypes={arrayOfOptionsGroupedByCategory:i().array.isRequired,isFormDisabled:i().bool.isRequired,isGrey:i().bool.isRequired,label:i().string.isRequired,name:i().string.isRequired,value:i().object.isRequired,onChange:i().func.isRequired};const ce=Te,ve=(t,n)=>t.reduce((o,s)=>(o[s.id]=T()(n,s.id,!1),o),{}),Be=(t,n)=>t.reduce((o,s)=>{const[a,l]=s,c=ve(l,n);return o[a]=c,o},{}),fe=(t,n,o)=>t.reduce((s,a)=>{const l=T()(n,[...a.pathToConditionsObject,"conditions"],{}),c=Be(o,l);return s[a.pathToConditionsObject.join("..")]=c,s},{}),X=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:a})=>{const{formatMessage:l}=(0,I.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=(0,Y.$_)(),u=(0,e.useMemo)(()=>Object.entries(oe()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:M,hasAllActionsSelected:x})=>g&&(M||x)),f=(0,e.useMemo)(()=>fe(p,d,u),[p,d,u]),[P,Z]=(0,e.useState)(f),O=(g,M)=>{Z((0,q.ZP)(x=>{x[g]||(x[g]={}),x[g].default||(x[g].default={}),x[g].default=M}))},y=()=>{const g=Object.entries(P).reduce((M,x)=>{const[D,w]=x,N=Object.values(w).reduce((H,B)=>({...H,...B}),{});return M[D]=N,M},{});m(g),a()};return e.createElement(ke.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(je.x,null,e.createElement(z.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((g,M,x)=>e.createElement(j.$,{isCurrent:M===x.length-1,key:g},ne()(l({id:g,defaultMessage:g})))))),e.createElement(V.f,null,p.length===0&&e.createElement(U.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:M,pathToConditionsObject:x},D)=>{const w=x.join("..");return e.createElement(ce,{key:g,arrayOfOptionsGroupedByCategory:u,label:M,isFormDisabled:o,isGrey:D%2===0,name:w,onChange:O,value:T()(P,w,{})})}))),e.createElement(te.m,{startActions:e.createElement(de.z,{variant:"tertiary",onClick:a},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(de.z,{onClick:y},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};X.propTypes={actions:i().arrayOf(i().shape({actionId:i().string.isRequired,checkboxName:i().string,hasSomeActionsSelected:i().bool.isRequired,hasAllActionsSelected:i().bool,isDisplayed:i().bool.isRequired,label:i().string})).isRequired,headerBreadCrumbs:i().arrayOf(i().string).isRequired,isFormDisabled:i().bool.isRequired,onClosed:i().func.isRequired,onToggle:i().func.isRequired};const _=X,ee=`${120/16}rem`,se=`${200/16}rem`,ye=`${53/16}rem`,Ne=h.ZP.div`
  width: ${ee};
`,rt=(0,h.ZP)(A.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,Ue=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:a,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,I.Z)();return e.createElement(A.k,{alignItems:"center",paddingLeft:6,style:{width:se,flexShrink:0}},e.createElement(E.x,{paddingRight:2},e.createElement(K.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:a}),disabled:s,onValueChange:f=>l({target:{name:d,value:f}}),indeterminate:m,value:u})),e.createElement(rt,{title:a,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:f})=>(f==="Enter"||f===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(U.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},ne()(a)),t))};Ue.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Ue.propTypes={checkboxName:i().string,children:i().node,label:i().string.isRequired,isCollapsable:i().bool,isFormDisabled:i().bool.isRequired,onChange:i().func,onClick:i().func.isRequired,someChecked:i().bool,value:i().bool,isActive:i().bool.isRequired};const it=(0,e.memo)(Ue);var Nt=r(42348),Vt=r.n(Nt),Wt=r(13218),he=r.n(Wt);const at=t=>he()(t)?Vt()(Object.values(t).map(n=>he()(n)?at(n):n)):[],Oe=at,ze=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,Re=t=>{const n=ze(t),o=Oe(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),a=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:a}};var Ht=r(12645);const Ve=(0,h.ZP)(Ht.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,We=t=>`
  ${U.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Ve} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Gt=(t,n,o)=>t.map(({actionId:s,isDisplayed:a,applyToProperties:l,label:c})=>{if(!a)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:a};const d=[...o.split(".."),s],m=k()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=T()(n,[...d,"conditions"],null),f=Oe(p).some(y=>y);if(k()(l)){const y=T()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:y,hasConditions:f,hasSomeActionsSelected:y,isDisplayed:a,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const P=T()(n,m,null),{hasAllActionsSelected:Z,hasSomeActionsSelected:O}=Re(P);return{actionId:s,checkboxName:u,hasAllActionsSelected:Z,hasConditions:f,hasSomeActionsSelected:O,isDisplayed:a,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),Ye=(t,n)=>`
  ${lt} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${dt} {
    display: flex;
  }
  ${ge} {
    display: block;
  }
  &:hover {
   ${We(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Ye(o,s)}
  }
  
`,lt=h.ZP.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${ye};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Kt=h.ZP.div`
  display: inline-flex;
  min-width: 100%;

  ${ge} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Ye(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Ye(t,n)}
  }
`,ct=(0,h.ZP)(A.k)`
  width: ${ee};
  position: relative;
`,dt=(0,h.ZP)(E.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,ut=h.ZP.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Ut=(0,h.ZP)(E.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,mt=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:a,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,I.Z)(),{modifiedData:p,onChangeParentCheckbox:f,onChangeSimpleCheckbox:P}=(0,Y.$_)(),Z=()=>{m(N=>!N)},O=()=>{m(!1)},y=T()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(y).reduce((N,H)=>(N[H]=xe()(y[H],"conditions"),N),{}),[y]),{hasAllActionsSelected:M,hasSomeActionsSelected:x}=Re(g),D=(0,e.useMemo)(()=>Gt(t,p,c),[t,p,c]),w=D.some(({hasConditions:N})=>N);return e.createElement(Kt,{isActive:n},e.createElement(lt,{isGrey:o},e.createElement(it,{isCollapsable:!0,isFormDisabled:s,label:a,checkboxName:c,onChange:f,onClick:l,someChecked:x,value:M,isActive:n},e.createElement(dt,{paddingLeft:2},n?e.createElement(pe.Z,null):e.createElement($e.Z,null))),e.createElement(A.k,{style:{flex:1}},D.map(({actionId:N,hasConditions:H,hasAllActionsSelected:B,hasSomeActionsSelected:ie,isDisplayed:Me,isParentCheckbox:J,checkboxName:me,label:He})=>Me?J?e.createElement(ct,{key:N,justifyContent:"center",alignItems:"center"},H&&e.createElement(ut,null),e.createElement(K.C,{disabled:s,name:me,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${He} ${a}`}),onValueChange:Ae=>{f({target:{name:me,value:Ae}})},indeterminate:ie,value:B})):e.createElement(ct,{key:N,justifyContent:"center",alignItems:"center"},H&&e.createElement(ut,null),e.createElement(K.C,{disabled:s,indeterminate:H,name:me,onValueChange:Ae=>{P({target:{name:me,value:Ae}})},value:B})):e.createElement(Ne,{key:N}))),d&&e.createElement(_,{headerBreadCrumbs:[a,"Settings.permissions.conditions.conditions"],actions:D,isFormDisabled:s,onClosed:O,onToggle:Z})),e.createElement(Ut,null,e.createElement(ge,{onClick:Z,hasConditions:w})))};mt.propTypes={availableActions:i().array.isRequired,isActive:i().bool.isRequired,isGrey:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggle:i().func.isRequired,pathToData:i().string.isRequired};const zt=mt,Yt=h.ZP.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,pt=()=>e.createElement(Yt,null,"*"),Xt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),wt=(0,h.ZP)(E.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Qt=h.ZP.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Xe=t=>e.createElement(wt,null,e.createElement(Qt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Xe.defaultProps={fill:"primary200"},Xe.propTypes={fill:i().string};const qt=(0,e.memo)(Xe),gt=(0,h.ZP)(A.k)`
  width: ${ee};
  position: relative;
`,Jt=(0,h.ZP)(A.k)`
  height: ${ye};
`,_t=(0,h.ZP)(E.x)`
  padding-left: ${31/16}rem;
`,en=(0,h.ZP)(E.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,tn=(0,h.ZP)(A.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,nn=h.ZP.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,we=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:a,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,I.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=(0,Y.$_)(),[f,P]=(0,e.useState)(null),Z=y=>{P(g=>g===y?null:y)},O=(0,e.useMemo)(()=>f?t.find(({value:y})=>y===f):null,[f,t]);return e.createElement(_t,null,e.createElement(nn,null),t.map(({label:y,value:g,required:M,children:x},D)=>{const w=D+1<t.length,N=Array.isArray(x),H=f===g;return e.createElement(en,{key:g,isVisible:w},e.createElement(Jt,null,e.createElement(qt,{color:"primary200"}),e.createElement(A.k,{style:{flex:1}},e.createElement(tn,{level:o,isActive:H,isCollapsable:N},e.createElement(rt,{alignItems:"center",isCollapsable:N,...N&&{onClick:()=>Z(g),"aria-expanded":H,onKeyDown:({key:B})=>(B==="Enter"||B===" ")&&Z(g),tabIndex:0,role:"button"},title:y},e.createElement(U.Z,{ellipsis:!0},ne()(y)),M&&e.createElement(pt,null),e.createElement(Ve,{$isActive:H}))),e.createElement(A.k,{style:{flex:1}},a.map(({actionId:B,label:ie,isActionRelatedToCurrentProperty:Me})=>{if(!Me)return e.createElement(Ne,{key:B});const J=[...s.split(".."),B,"properties",c,...l.split(".."),g],me=T()(m,J,!1);if(!x)return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(K.C,{disabled:n,name:J.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${y} ${ie}`}),onValueChange:Pe=>{p({target:{name:J.join(".."),value:Pe}})},value:me}));const{hasAllActionsSelected:He,hasSomeActionsSelected:Ae}=Re(me);return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(K.C,{key:ie,disabled:n,name:J.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${y} ${ie}`}),onValueChange:Pe=>{u({target:{name:J.join(".."),value:Pe}})},value:He,indeterminate:Ae}))})))),O&&H&&e.createElement(E.x,{paddingBottom:2},e.createElement(we,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:a,propertyName:c,recursiveLevel:o+1,childrenForm:O.children})))}))};we.propTypes={childrenForm:i().array.isRequired,isFormDisabled:i().bool.isRequired,parentName:i().string.isRequired,pathToDataFromActionRow:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,recursiveLevel:i().number.isRequired};const sn=(0,e.memo)(we),on=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),rn=(t,n,o,s,a)=>{const c=on(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,a],p=T()(n,u,!1);return d[m]=p,d},{});return Re(c)},ft=(0,h.ZP)(A.k)`
  width: ${ee};
  position: relative;
`,an=(0,h.ZP)(A.k)`
  height: ${ye};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,Qe=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:a,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,I.Z)(),[p,f]=(0,e.useState)(null),{modifiedData:P,onChangeCollectionTypeLeftActionRowCheckbox:Z,onChangeParentCheckbox:O,onChangeSimpleCheckbox:y}=(0,Y.$_)(),g=p===s,M=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),x=M.length>0,D=(0,e.useCallback)(()=>{x&&f(B=>B===s?null:s)},[x,s]),w=({target:{value:B}})=>{Z(l,d,s,B)},{hasAllActionsSelected:N,hasSomeActionsSelected:H}=(0,e.useMemo)(()=>rn(c,P,l,d,s),[c,P,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(an,{alignItems:"center",isCollapsable:x,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(A.k,null,e.createElement(it,{onChange:w,onClick:D,isCollapsable:x,isFormDisabled:o,label:n,someChecked:H,value:N,isActive:g},a&&e.createElement(pt,null),e.createElement(Ve,{$isActive:g})),e.createElement(A.k,null,c.map(({label:B,isActionRelatedToCurrentProperty:ie,actionId:Me})=>{if(!ie)return e.createElement(Ne,{key:B});const J=[...l.split(".."),Me,"properties",d,s];if(!x){const Pe=T()(P,J,!1);return e.createElement(ft,{key:Me,justifyContent:"center",alignItems:"center"},e.createElement(K.C,{disabled:o,name:J.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${B}`}),onValueChange:ns=>{y({target:{name:J.join(".."),value:ns}})},value:Pe}))}const me=T()(P,J,{}),{hasAllActionsSelected:He,hasSomeActionsSelected:Ae}=Re(me);return e.createElement(ft,{key:B,justifyContent:"center",alignItems:"center"},e.createElement(K.C,{disabled:o,name:J.join(".."),onValueChange:Pe=>{O({target:{name:J.join(".."),value:Pe}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${B}`}),value:He,indeterminate:Ae}))})))),g&&e.createElement(sn,{childrenForm:M,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};Qe.defaultProps={childrenForm:[],required:!1},Qe.propTypes={childrenForm:i().array,label:i().string.isRequired,isFormDisabled:i().bool.isRequired,name:i().string.isRequired,pathToData:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,required:i().bool,isOdd:i().bool.isRequired};const ln=(0,e.memo)(Qe),yt=(0,h.ZP)(A.k)`
  width: ${ee};
  flex-shrink: 0;
`,cn=(0,h.ZP)(A.k)`
  width: ${se};
  height: ${ye};
  flex-shrink: 0;
`,ht=({headers:t,label:n})=>{const{formatMessage:o}=(0,I.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(A.k,null,e.createElement(cn,{alignItems:"center",paddingLeft:6},e.createElement(U.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(a=>a.isActionRelatedToCurrentProperty?e.createElement(yt,{justifyContent:"center",key:a.label},e.createElement(U.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${a.label.toLowerCase()}`,defaultMessage:a.label}))):e.createElement(yt,{key:a.label})))};ht.propTypes={headers:i().arrayOf(i().shape({label:i().string.isRequired,isActionRelatedToCurrentProperty:i().bool.isRequired})).isRequired,label:i().string.isRequired};const dn=ht,un=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),mn=h.ZP.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,Ct=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:a,propertyName:l})=>{const c=(0,e.useMemo)(()=>un(t,l),[t,l]);return e.createElement(mn,null,e.createElement(dn,{label:s,headers:c}),e.createElement(E.x,null,n.map(({children:d,label:m,value:u,required:p},f)=>e.createElement(ln,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:a,propertyName:l,isOdd:f%2===0}))))};Ct.propTypes={childrenForm:i().array.isRequired,availableActions:i().array.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,pathToData:i().string.isRequired,propertyName:i().string.isRequired};const pn=Ct,gn=h.ZP.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,Et=({allActions:t,contentTypeName:n,label:o,index:s,isActive:a,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>Xt(t,n),[t,n]);return e.createElement(gn,{isActive:a},e.createElement(zt,{availableActions:p,isActive:a,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),a&&m.map(({label:f,value:P,children:Z})=>e.createElement(pn,{availableActions:p,childrenForm:Z,isFormDisabled:l,label:f,pathToData:d,propertyName:P,key:P})))};Et.propTypes={allActions:i().array.isRequired,contentTypeName:i().string.isRequired,index:i().number.isRequired,isActive:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggleCollapse:i().func.isRequired,pathToData:i().string.isRequired,properties:i().array.isRequired};const fn=Et,qe=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[a,l]=(0,e.useState)(null),c=d=>{l(a===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(fn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:a===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};qe.defaultProps={actions:[],subjects:[]},qe.propTypes={actions:i().array.isRequired,isFormDisabled:i().bool.isRequired,pathToData:i().string.isRequired,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))};const yn=(0,e.memo)(qe),hn=t=>t.filter(({subjects:n})=>n&&n.length),Cn=t=>t.map(({actionId:n})=>n),En=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(a=>{const l=T()(n,[a,s],{}),c={[a]:ze(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),bn=(t,n)=>{const o=Cn(t),s=En(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=Re(s[c]),l),{})},vn=(0,h.ZP)(A.k)`
  width: ${ee};
  flex-shrink: 0;
`,Je=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,I.Z)(),{modifiedData:a,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,Y.$_)(),c=(0,e.useMemo)(()=>hn(t),[t]),d=(0,e.useMemo)(()=>bn(c,a[o]),[a,c,o]);return e.createElement(E.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:se}},e.createElement(A.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(vn,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(U.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(K.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:T()(d,[u,"hasAllActionsSelected"],!1),indeterminate:T()(d,[u,"hasSomeActionsSelected"],!1)})))))};Je.defaultProps={actions:[]},Je.propTypes={actions:i().arrayOf(i().shape({label:i().string.isRequired,actionId:i().string.isRequired,subjects:i().array.isRequired})),isFormDisabled:i().bool.isRequired,kind:i().string.isRequired};const Rn=(0,e.memo)(Je),An=(0,h.ZP)(E.x)`
  overflow-x: auto;
`,bt=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const a=Ce()([...s],"label");return e.createElement(An,{background:"neutral0"},e.createElement(Rn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(yn,{actions:o,isFormDisabled:t,pathToData:n,subjects:a}))};bt.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().shape({actions:i().array,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))}).isRequired};const vt=(0,e.memo)(bt);var Pn=r(18542);const Rt=({children:t,value:n})=>e.createElement(Pn.$l.Provider,{value:n},t);Rt.propTypes={children:i().node.isRequired,value:i().exact({availableConditions:i().array.isRequired,modifiedData:i().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:i().func.isRequired,onChangeConditions:i().func.isRequired,onChangeSimpleCheckbox:i().func.isRequired,onChangeParentCheckbox:i().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:i().func.isRequired}).isRequired};const xn=Rt;var Sn=r(48734),Tn=r(74756),On=r(63081),At=r(36213),Mn=r(11276),$n=r(67819);const Ln=(t,n,o)=>t.map(s=>{const a=[...o,s.action,"properties","enabled"],l=T()(n,a,!1),c=T()(n,[...o,s.action,"conditions"],{}),d=Oe(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:a.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),Dn=t=>{const n=Object.entries(t).reduce((s,a)=>{const[l,{conditions:c}]=a;return s[l]=c,s},{});return Oe(n).some(s=>s)},kn=h.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,jn=h.ZP.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,Pt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:a})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=(0,Y.$_)(),{formatMessage:p}=(0,I.Z)(),f=T()(d,a,{}),P=(0,e.useMemo)(()=>Object.keys(f).reduce((D,w)=>(D[w]=ze(f[w]),D),{}),[f]),{hasAllActionsSelected:Z,hasSomeActionsSelected:O}=Re(P),y=()=>{c(D=>!D)},g=()=>{c(!1)},M=Ln(s,d,a),x=Dn(T()(d,[...a],{}));return e.createElement(e.Fragment,null,e.createElement(E.x,null,e.createElement(A.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(E.x,{paddingRight:4},e.createElement(U.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(kn,null),e.createElement(E.x,{paddingLeft:4},e.createElement(At.X,{name:a.join(".."),disabled:n,onValueChange:D=>{m({target:{name:a.join(".."),value:D}})},indeterminate:O,value:Z},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(A.k,{paddingTop:6,paddingBottom:6},e.createElement(Mn.r,{gap:2,style:{flex:1}},M.map(({checkboxName:D,value:w,action:N,displayName:H,hasConditions:B})=>e.createElement($n.P,{col:3,key:N},e.createElement(jn,{disabled:n,hasConditions:B},e.createElement(At.X,{name:D,disabled:n,onValueChange:ie=>{u({target:{name:D,value:ie}})},value:w},H))))),e.createElement(ge,{hasConditions:x,onClick:y}))),l&&e.createElement(_,{headerBreadCrumbs:[t,o],actions:M,isFormDisabled:n,onClosed:g,onToggle:y}))};Pt.propTypes={actions:i().array.isRequired,categoryName:i().string.isRequired,isFormDisabled:i().bool.isRequired,subCategoryName:i().string.isRequired,pathToData:i().array.isRequired};const In=Pt,_e=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:a,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,I.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(Sn.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Tn.B,{title:ne()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(On.v,null,e.createElement(E.x,{padding:6},t.map(({actions:f,subCategoryName:P,subCategoryId:Z})=>e.createElement(In,{key:P,actions:f,categoryName:p,isFormDisabled:a,subCategoryName:P,pathToData:[...d,Z]})))))};_e.defaultProps={},_e.propTypes={childrenForm:i().array.isRequired,isOpen:i().bool.isRequired,isFormDisabled:i().bool.isRequired,isWhite:i().bool.isRequired,kind:i().string.isRequired,name:i().string.isRequired,onOpenCategory:i().func.isRequired,pathToData:i().array.isRequired};const Zn=_e,xt=({isFormDisabled:t,kind:n,layout:o})=>{const[s,a]=(0,e.useState)(null),l=c=>{a(c===s?null:c)};return e.createElement(E.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(Zn,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};xt.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().arrayOf(i().shape({category:i().string.isRequired,categoryId:i().string.isRequired,childrenForm:i().arrayOf(i().shape({actions:i().array.isRequired})).isRequired}).isRequired).isRequired};const St=xt;var Fn=r(82492),Bn=r.n(Fn),Nn=r(36968),re=r.n(Nn);const Tt=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),Ot=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),Mt=({children:t},n,o="")=>t.reduce((s,a)=>{if(a.children)return{...s,[a.value]:Mt(a,n,`${o}${a.value}.`)};const l=n.indexOf(`${o}${a.value}`)!==-1;return s[a.value]=l,s},{}),Vn=(t,n,o)=>t.reduce((s,a)=>{const l=n.properties.find(({value:c})=>c===a);if(l){const c=T()(o,["properties",l.value],[]),d=Mt(l,c);s.properties[a]=d}return s},{properties:{}}),Wn=(t,n)=>n.reduce((o,s)=>{const a=t.find(({uid:l})=>l===s)||null;return a&&(o[s]=a),o},{}),$t=({subjects:t},n,o,s=[])=>n.reduce((a,l)=>{const c=l.subjects,d=Wn(t,c);if(k()(d))return a;const m=Object.keys(d).reduce((u,p)=>{const{actionId:f,applyToProperties:P}=l,y=d[p].properties.map(({value:D})=>D).every(D=>(P||[]).indexOf(D)===-1),g=Tt(s,f,p),M=Ot(o,T()(g,"conditions",[]));if(k()(P)||y)return re()(u,[p,f],{properties:{enabled:g!==void 0},conditions:M}),u;const x=Vn(P,d[p],g);return re()(u,[p,f],{...x,conditions:M}),u},{});return Bn()(a,m)},{}),Hn=(t,n,o)=>t.reduce((s,a)=>{const l=Tt(o,a.action,null);return s[a.action]={properties:{enabled:l!==void 0},conditions:Ot(n,l?.conditions??[])},s},{}),Gn=(t,n,o)=>t.reduce((s,a)=>(s[a.subCategoryId]=Hn(a.actions,n,o),s),{}),Lt=(t,n,o=[])=>t.reduce((s,{categoryId:a,childrenForm:l})=>{const c=Gn(l,n,o);return s[a]=c,s},{}),Dt=t=>t.split(" ").join("-"),kt=(t,n)=>Object.entries(oe()(t,n)).map(([o,s])=>({category:o,categoryId:Dt(o),childrenForm:Object.entries(oe()(s,"subCategory")).map(([a,l])=>({subCategoryName:a,subCategoryId:Dt(a),actions:l}))})),Kn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:a,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:a,plugins:kt(l,"plugin"),settings:kt(c,"category")},m={collectionTypes:$t(s,s.actions||[],o,n),singleTypes:$t(a,a.actions||[],o,n),plugins:Lt(d.plugins,o,n),settings:Lt(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Un=r(50361),et=r.n(Un);const jt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(he()(s)&&!v()(s,"conditions"))return{...n,[o]:jt(s)};if(he()(s)&&v()(s,"conditions")&&!Oe(xe()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),tt=jt,It=(t,n,o=!1)=>Object.keys(t).reduce((s,a)=>{const l=t[a];return a==="conditions"&&!o?(s[a]=l,s):he()(l)?{...s,[a]:It(l,n,a==="fields")}:(s[a]=n,s)},{}),Ke=It,zn={initialData:{},modifiedData:{},layouts:{}},Yn=(t,n)=>(0,q.ZP)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:a,value:l}=n,c=["modifiedData",s];Object.keys(T()(t,c)).forEach(d=>{const m=T()(t,[...c,d,a],void 0);if(m){let u=Ke(m,l);if(!l&&u.conditions){const p=Ke(u.conditions,!1);u={...u,conditions:p}}re()(o,[...c,d,a],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:a,rowName:l,value:c}=n;let d=et()(t.modifiedData);const m=s.split(".."),u=T()(d,m,{});Object.keys(u).forEach(p=>{if(v()(u[p],`properties.${a}`)){const f=T()(u,[p,"properties",a,l]),P=[...m,p,"properties",a,l];if(!he()(f))re()(d,P,c);else{const Z=Ke(f,c);re()(d,P,Z)}}}),c||(d=tt(d)),re()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[a,l]=s;re()(o,["modifiedData",...a.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=et()(t.modifiedData);re()(s,[...n.keys.split("..")],n.value),n.value||(s=tt(s)),re()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:a}=n,l=[...s.split("..")];let c=et()(t.modifiedData);const d=T()(c,l,{}),m=Ke(d,a);re()(c,l,m),a||(c=tt(c)),re()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),nt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),Xn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:nt(o),properties:{}}},wn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((a,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return a;const d=Xn(l);return a.push(d),a},[]);return[...n,...s]},[]),Zt=t=>Object.values(t).reduce((n,o)=>{const s=wn(o);return[...n,...s]},[]),Ft=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[a,l]=s;return he()(l)?[...o,...Ft(l,`${n}${a}.`)]:(l&&!he()(l)&&o.push(`${n}${a}`),o)},[]),Qn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((a,l)=>{const[c,d]=l;return a.properties[c]=Ft(d),a},{action:t,subject:n,conditions:nt(o),properties:{}}),qn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:nt(o)}),Jn=(t,n)=>Object.entries(n).reduce((s,a)=>{const[l,c]=a;if(!Oe(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=Qn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=qn(l,t,c);return s.push(m),s},[]),Bt=t=>Object.entries(t).reduce((o,s)=>{const[a,l]=s,c=Jn(a,l);return[...o,...c]},[]),_n=t=>{const n=Zt(t.plugins),o=Zt(t.settings),s=Bt(t.collectionTypes),a=Bt(t.singleTypes);return[...n,...o,...s,...a]},es=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],st=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:a,layouts:l,modifiedData:c},d]=(0,e.useReducer)(Yn,zn,()=>Kn(t,o)),{formatMessage:m}=(0,I.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const O=(0,L.e5)(a.collectionTypes,c.collectionTypes),y=(0,L.e5)(a.singleTypes,c.singleTypes),g={...O,...y};let M;return k()(g)?M=!1:M=Object.values(g).some(x=>Object.values(x).some(D=>v()(D,"conditions"))),{permissionsToSend:_n(c),didUpdateConditions:M}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(O,y,g,M)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:O,propertyName:y,rowName:g,value:M})},p=(O,y,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:O,actionId:y,value:g})},f=O=>{d({type:"ON_CHANGE_CONDITIONS",conditions:O})},P=(0,e.useCallback)(({target:{name:O,value:y}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:O,value:y})},[]),Z=(0,e.useCallback)(({target:{name:O,value:y}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:O,value:y})},[]);return e.createElement(xn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:f,onChangeSimpleCheckbox:P,onChangeParentCheckbox:Z,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(b.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement($.m,null,es.map(O=>e.createElement($.O,{key:O.id},m({id:O.labelId,defaultMessage:O.defaultMessage})))),e.createElement(C.n,{style:{position:"relative"}},e.createElement(C.x,null,e.createElement(vt,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(C.x,null,e.createElement(vt,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(C.x,null,e.createElement(St,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(C.x,null,e.createElement(St,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});st.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},st.propTypes={layout:i().object,isFormDisabled:i().bool.isRequired,permissions:i().array};const ts=(0,e.memo)(st)},63727:(G,F,r)=>{"use strict";r.r(F),r.d(F,{default:()=>U});var e=r(67294),b=r(30422),$=r(86706),C=r(16550),L=r(36364),S=r(185),v=r(53979),R=r(11047),k=r(29728),Q=r(49066),i=r(41580),I=r(67109),E=r(41054),ae=r(86896),Ce=r(4644),h=r(51754),A=r(90065),K=r(442),pe=r(75515),$e=r(11276),Ee=r(67819),T=r(16364),Le=r(61467),xe=r(45697),Y=r.n(xe);const de=({disabled:te,role:z,values:j,errors:q,onChange:le,onBlur:oe})=>{const{formatMessage:W}=(0,ae.Z)();return e.createElement(i.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(R.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(R.k,{justifyContent:"space-between"},e.createElement(i.x,null,e.createElement(i.x,null,e.createElement(pe.Z,{fontWeight:"bold"},z?z.name:W({id:"global.details",defaultMessage:"Details"}))),e.createElement(i.x,null,e.createElement(pe.Z,{textColor:"neutral500",variant:"pi"},z?z.description:W({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(k.z,{disabled:!0,variant:"secondary"},W({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:z.usersCount}))),e.createElement($e.r,{gap:4},e.createElement(Ee.P,{col:6},e.createElement(T.o,{disabled:te,name:"name",error:q.name&&W({id:q.name}),label:W({id:"global.name",defaultMessage:"Name"}),onChange:le,onBlur:oe,required:!0,value:j.name||""})),e.createElement(Ee.P,{col:6},e.createElement(Le.g,{disabled:te,label:W({id:"global.description",defaultMessage:"Description"}),id:"description",error:q.name&&W({id:q.name}),onChange:le,onBlur:oe},j.description||"")))))};de.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},de.propTypes={disabled:Y().bool,errors:Y().object.isRequired,onBlur:Y().func.isRequired,onChange:Y().func.isRequired,role:Y().object,values:Y().object};const be=de;var De=r(87561);const ge=De.Ry().shape({name:De.Z_().required(b.I0.required)}),je=()=>{const te=(0,b.lm)(),{formatMessage:z}=(0,ae.Z)(),{params:{id:j}}=(0,C.$B)("/settings/roles/:id"),{put:q}=(0,b.kY)(),[le,oe]=(0,e.useState)(!1),W=(0,e.useRef)(),{lockApp:ne,unlockApp:Ie}=(0,b.o1)(),{trackUsage:Ze}=(0,b.rS)(),{formatAPIError:ue}=(0,b.So)(),{isLoading:Fe,data:Te}=(0,A.d)(j,{cacheTime:0}),{roles:[ce={}],isLoading:ve,refetch:Be}=(0,h.F)({id:j},{cacheTime:0}),{permissions:Ge,isLoading:fe}=(0,Ce.V)({id:j},{cacheTime:0}),X=async ee=>{try{ne(),oe(!0);const{permissionsToSend:se,didUpdateConditions:ye}=W.current.getPermissions();await q(`/admin/roles/${j}`,ee),ce.code!=="strapi-super-admin"&&(await q(`/admin/roles/${j}/permissions`,{permissions:se}),ye&&Ze("didUpdateConditions")),W.current.setFormAfterSubmit(),await Be(),te({type:"success",message:{id:"notification.success.saved"}})}catch(se){te({type:"warning",message:ue(se)})}finally{oe(!1),Ie()}},_=!ve&&ce.code==="strapi-super-admin";return e.createElement(S.o,null,e.createElement(b.SL,{name:"Roles"}),e.createElement(E.J9,{enableReinitialize:!0,initialValues:{name:ce.name,description:ce.description},onSubmit:X,validationSchema:ge,validateOnChange:!1},({handleSubmit:ee,values:se,errors:ye,handleChange:ot,handleBlur:Ne})=>e.createElement("form",{onSubmit:ee},e.createElement(v.T,{primaryAction:e.createElement(R.k,{gap:2},e.createElement(k.z,{disabled:ce.code==="strapi-super-admin",onClick:ee,loading:le,size:"L"},z({id:"global.save",defaultMessage:"Save"}))),title:z({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:z({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(b.rU,{startIcon:e.createElement(I.Z,null),to:"/settings/roles"},z({id:"global.back",defaultMessage:"Back"}))}),e.createElement(Q.D,null,e.createElement(R.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(be,{isLoading:ve||fe,disabled:_,errors:ye,values:se,onChange:ot,onBlur:Ne,role:ce}),!Fe&&!ve&&!fe?e.createElement(i.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(K.Z,{isFormDisabled:_,permissions:Ge,ref:W,layout:Te})):e.createElement(i.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(b.dO,null)))))))},U=()=>{const te=(0,$.v9)(L._),{isLoading:z,allowedActions:{canRead:j,canUpdate:q}}=(0,b.ss)({read:te.settings.roles.read,update:te.settings.roles.update});return z?e.createElement(b.dO,null):!j&&!q?e.createElement(C.l_,{to:"/"}):e.createElement(je,null)}},90065:(G,F,r)=>{"use strict";r.d(F,{d:()=>$});var e=r(30422),b=r(88767);const $=(C,L={})=>{const{get:S}=(0,e.kY)(),{data:v,error:R,isError:k,isLoading:Q}=(0,b.useQuery)(["permissions",C],async()=>{const{data:{data:i}}=await S("/admin/permissions",{params:{role:C}});return i},L);return{data:v,error:R,isError:k,isLoading:Q}}},44174:G=>{function F(r,e,b,$){for(var C=-1,L=r==null?0:r.length;++C<L;){var S=r[C];e($,S,b(S),r)}return $}G.exports=F},81119:(G,F,r)=>{var e=r(89881);function b($,C,L,S){return e($,function(v,R,k){C(S,v,L(v),k)}),S}G.exports=b},55189:(G,F,r)=>{var e=r(44174),b=r(81119),$=r(67206),C=r(1469);function L(S,v){return function(R,k){var Q=C(R)?e:b,i=v?v():{};return Q(R,S,$(k,2),i)}}G.exports=L},42348:(G,F,r)=>{var e=r(21078),b=1/0;function $(C){var L=C==null?0:C.length;return L?e(C,b):[]}G.exports=$},7739:(G,F,r)=>{var e=r(89465),b=r(55189),$=Object.prototype,C=$.hasOwnProperty,L=b(function(S,v,R){C.call(S,R)?S[R].push(v):e(S,R,[v])});G.exports=L},38953:(G,F,r)=>{"use strict";r.d(F,{Q:()=>C});var e=r(85893),b=r(71997),$=r(67730);const C=({options:S,...v})=>(0,e.jsx)($.NU,{...v,children:S.map(R=>"children"in R?(0,e.jsx)($.Ab,{label:R.label,values:R.children.map(k=>k.value.toString()),children:R.children.map(k=>(0,e.jsx)(L,{value:k.value,children:k.label},k.value))},R.label):(0,e.jsx)($.ML,{value:R.value,children:R.label},R.value))}),L=(0,b.ZP)($.ML)`
  padding-left: ${({theme:S})=>S.spaces[7]};
`}}]);
