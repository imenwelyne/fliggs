(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[2458],{49699:(T,m,t)=>{"use strict";t.d(m,{Z:()=>C});var e=t(53547),p=t(53979),l=t(11047),o=t(29728),a=t(1784),i=t(85018),u=t(67109),A=t(45697),s=t.n(A),h=t(86896),v=t(30815),n=t(92807);const y=({onRegenerate:R,idToRegenerate:O,backUrl:H,onError:z})=>{const{formatMessage:B}=(0,h.Z)(),[k,F]=(0,e.useState)(!1),{regenerateData:Z,isLoadingConfirmation:Y}=(0,n.rW)(H,O,R,z),V=async()=>{Z(),F(!1)};return e.createElement(e.Fragment,null,e.createElement(o.z,{startIcon:e.createElement(v.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>F(!0),name:"regenerate"},B({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(a.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(v.Z,null),isConfirmButtonLoading:Y,isOpen:k,onToggleDialog:()=>F(!1),onConfirm:V,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};y.defaultProps={onRegenerate(){},onError:void 0},y.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const P=y,M=({title:R,token:O,setToken:H,canEditInputs:z,canRegenerate:B,isSubmitting:k,backUrl:F,regenerateUrl:Z,onErrorRegenerate:Y})=>{const{formatMessage:V}=(0,h.Z)(),w=ee=>{H({...O,accessKey:ee})};return e.createElement(p.T,{title:O?.name||V(R),primaryAction:z?e.createElement(l.k,{gap:2},B&&O?.id&&e.createElement(P,{backUrl:Z,onRegenerate:w,idToRegenerate:O?.id,onError:Y}),e.createElement(o.z,{disabled:k,loading:k,startIcon:e.createElement(i.Z,null),type:"submit",size:"S"},V({id:"global.save",defaultMessage:"Save"}))):B&&O?.id&&e.createElement(P,{onRegenerate:w,idToRegenerate:O?.id,backUrl:Z}),navigationAction:e.createElement(a.rU,{startIcon:e.createElement(u.Z,null),to:F},V({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};M.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},M.defaultProps={token:void 0,onErrorRegenerate:void 0};const C=M},89982:(T,m,t)=>{"use strict";t.d(m,{Z:()=>h});var e=t(53547),p=t(40619),l=t(82562),o=t(75515),a=t(45697),i=t.n(a),u=t(86896),A=t(51352);const s=({token:v,errors:n,values:y,onChange:P,isCreating:M})=>{const{formatMessage:C}=(0,u.Z)();return e.createElement(e.Fragment,null,e.createElement(p.P,{name:"lifespan",label:C({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:y.lifespan!==null?y.lifespan:"0",error:n.lifespan?C(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:R=>{P({target:{name:"lifespan",value:R}})},required:!0,disabled:!M,placeholder:"Select"},e.createElement(l.W,{value:"604800000"},C({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(l.W,{value:"2592000000"},C({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(l.W,{value:"7776000000"},C({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(l.W,{value:"0"},C({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!M&&`${C({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,A.IX)(v?.createdAt,parseInt(y.lifespan,10))}`))};s.propTypes={errors:i().shape({lifespan:i().string}),onChange:i().func.isRequired,values:i().shape({lifespan:i().oneOfType([i().number,i().string])}).isRequired,isCreating:i().bool.isRequired,token:i().shape({id:i().oneOfType([i().number,i().string]),type:i().string,lifespan:i().string,name:i().string,accessKey:i().string,permissions:i().array,description:i().string,createdAt:i().string})},s.defaultProps={errors:{},token:{}};const h=s},81384:(T,m,t)=>{"use strict";t.d(m,{Z:()=>h});var e=t(53547),p=t(12028),l=t(1784),o=t(65186),a=t(69427),i=t(45697),u=t.n(i),A=t(86896);const s=({token:v,tokenType:n})=>{const{formatMessage:y}=(0,A.Z)(),P=(0,l.lm)(),{trackUsage:M}=(0,l.rS)(),{copy:C}=(0,l.VP)(),R=O=>async()=>{await C(O)&&(M("didCopyTokenKey",{tokenType:n}),P({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return e.createElement(l.Y_,{endAction:v&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(p.h,{label:y({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:R(v),noBorder:!0,icon:e.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:v||y({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:y(v?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:u().string,tokenType:u().string.isRequired};const h=s},37651:(T,m,t)=>{"use strict";t.d(m,{Z:()=>u});var e=t(53547),p=t(61467),l=t(45697),o=t.n(l),a=t(86896);const i=({errors:A,values:s,onChange:h,canEditInputs:v})=>{const{formatMessage:n}=(0,a.Z)();return e.createElement(p.g,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:A.description?n(A.description?.id?A.description:{id:A.description,defaultMessage:A.description}):null,onChange:h,disabled:!v},s.description)};i.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},72028:(T,m,t)=>{"use strict";t.d(m,{Z:()=>u});var e=t(53547),p=t(16364),l=t(45697),o=t.n(l),a=t(86896);const i=({errors:A,values:s,onChange:h,canEditInputs:v})=>{const{formatMessage:n}=(0,a.Z)();return e.createElement(p.o,{name:"name",error:A.name?n(A.name?.id?A.name:{id:A.name,defaultMessage:A.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:h,value:s.name,disabled:!v,required:!0})};i.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},32381:(T,m,t)=>{"use strict";t.d(m,{Z:()=>A});var e=t(53547),p=t(40619),l=t(82562),o=t(45697),a=t.n(o),i=t(86896);const u=({name:s,errors:h,values:v,onChange:n,canEditInputs:y,options:P,label:M})=>{const{formatMessage:C}=(0,i.Z)();return e.createElement(p.P,{name:s,label:C({id:M.id,defaultMessage:M.defaultMessage}),value:v&&v[s],error:h[s]?C(h[s]?.id?h[s]:{id:h[s],defaultMessage:h[s]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!y},P&&P.map(({value:R,label:O})=>e.createElement(l.W,{key:R,value:R},C(O))))};u.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},u.defaultProps={name:"type",errors:{},options:[]};const A=u},81966:(T,m,t)=>{"use strict";t.d(m,{Z:()=>e,f:()=>p});const e="api-token",p="transfer-token"},92458:(T,m,t)=>{"use strict";t.d(m,{Z:()=>Ye});var e=t(53547),p=t(185),l=t(49066),o=t(11047),a=t(1784),i=t(41054),u=t(86896),A=t(88767),s=t(86706),h=t(89548),v=t(45697),n=t.n(v);const y=(0,e.createContext)({}),P=({children:r,...c})=>e.createElement(y.Provider,{value:c},r),M=()=>(0,e.useContext)(y);P.propTypes={children:n().node.isRequired};var C=t(35209),R=t(36364),O=t(81966),H=t(49699),z=t(81384),B=t(41580),k=t(75515),F=t(11276),Z=t(67819),Y=t(89982),V=t(37651),w=t(72028),ee=t(32381);const te=({errors:r,onChange:c,canEditInputs:d,isCreating:I,values:E,apiToken:D,onDispatch:f,setHasChangedPermissions:$})=>{const{formatMessage:N}=(0,u.Z)(),K=({target:{value:b}})=>{$(!1),b==="full-access"&&f({type:"SELECT_ALL_ACTIONS"}),b==="read-only"&&f({type:"ON_CHANGE_READ_ONLY"})},X=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(B.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(k.Z,{variant:"delta",as:"h2"},N({id:"global.details",defaultMessage:"Details"})),e.createElement(F.r,{gap:5},e.createElement(Z.P,{key:"name",col:6,xs:12},e.createElement(w.Z,{errors:r,values:E,canEditInputs:d,onChange:c})),e.createElement(Z.P,{key:"description",col:6,xs:12},e.createElement(V.Z,{errors:r,values:E,canEditInputs:d,onChange:c})),e.createElement(Z.P,{key:"lifespan",col:6,xs:12},e.createElement(Y.Z,{isCreating:I,errors:r,values:E,onChange:c,token:D})),e.createElement(Z.P,{key:"type",col:6,xs:12},e.createElement(ee.Z,{values:E,errors:r,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:b=>{K({target:{value:b}}),c({target:{name:"type",value:b}})},options:X,canEditInputs:d})))))};te.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},te.defaultProps={errors:{},apiToken:{}};const Ee=te;var fe=t(53979),ye=t(29728),Te=t(85018);const ne=({apiTokenName:r})=>{const{formatMessage:c}=(0,u.Z)();return(0,a.go)(),e.createElement(p.o,{"aria-busy":"true"},e.createElement(a.SL,{name:"API Tokens"}),e.createElement(fe.T,{primaryAction:e.createElement(ye.z,{disabled:!0,startIcon:e.createElement(Te.Z,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:r||c({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(l.D,null,e.createElement(a.dO,null)))};ne.defaultProps={apiTokenName:null},ne.propTypes={apiTokenName:n().string};const he=ne;var Ae=t(35161),ve=t.n(Ae),Ce=t(13217),Pe=t.n(Ce),_=t(1565);const Me=r=>{switch(r){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Re=(0,_.default)(B.x)`
  margin: -1px;
  border-radius: ${({theme:r})=>r.spaces[1]} 0 0 ${({theme:r})=>r.spaces[1]};
`;function se({route:r}){const{formatMessage:c}=(0,u.Z)(),{method:d,handler:I,path:E}=r,D=E?Pe()(E.split("/")):[],[f="",$=""]=I?I.split("."):[],N=Me(r.method);return e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,f),e.createElement(k.Z,{variant:"delta",textColor:"primary600"},".",$)),e.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Re,{background:N.background,borderColor:N.border,padding:2},e.createElement(k.Z,{fontWeight:"bold",textColor:N.text},d)),e.createElement(B.x,{paddingLeft:2,paddingRight:2},ve()(D,K=>e.createElement(k.Z,{key:K,textColor:K.includes(":")?"neutral600":"neutral900"},"/",K)))))}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Oe=se,Ie=()=>{const{value:{selectedAction:r,routes:c}}=M(),{formatMessage:d}=(0,u.Z)(),I=r?.split(".")[0];return e.createElement(Z.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},c[I]?.map(E=>E.config.auth?.scope?.includes(r)||E.handler===r?e.createElement(Oe,{key:E.handler,route:E}):null)):e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h3"},d({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(k.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var De=t(48734),Se=t(74756),ke=t(63081),ue=t(36213),xe=t(78114),Le=t(48403),Be=t.n(Le);const ge=(0,_.css)`
  background: ${r=>r.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,_.default)(B.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${r=>r.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${r=>r.isActive&&ge}
  &:hover {
    ${ge}
  }
`,Ze=_.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:r})=>r.colors.neutral150};
`,ae=({controllers:r,label:c,orderNumber:d,disabled:I,onExpanded:E,indexExpandendCollapsedContent:D})=>{const{value:{onChangeSelectAll:f,onChange:$,selectedActions:N,setSelectedAction:K,selectedAction:X}}=M(),[b,q]=(0,e.useState)(!1),{formatMessage:le}=(0,u.Z)(),j=()=>{q(S=>!S),E(d)};(0,e.useEffect)(()=>{D!==null&&D!==d&&b&&q(!1)},[D,d,b]);const L=S=>S===X;return e.createElement(De.U,{expanded:b,onToggle:j,variant:d%2?"primary":"secondary"},e.createElement(Se.B,{title:Be()(c)}),e.createElement(ke.v,null,r?.map(S=>{const Q=S.actions.every(U=>N.includes(U.actionId)),re=S.actions.some(U=>N.includes(U.actionId));return e.createElement(B.x,{key:`${c}.${S?.controller}`},e.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(B.x,{paddingRight:4},e.createElement(k.Z,{variant:"sigma",textColor:"neutral600"},S?.controller)),e.createElement(Ze,null),e.createElement(B.x,{paddingLeft:4},e.createElement(ue.X,{value:Q,indeterminate:!Q&&re,onValueChange:()=>{f({target:{value:[...S.actions]}})},disabled:I},le({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(F.r,{gap:4,padding:4},S?.actions&&S?.actions.map(U=>e.createElement(Z.P,{col:6,key:U.actionId},e.createElement(Ue,{isActive:L(U.actionId),padding:2,hasRadius:!0},e.createElement(ue.X,{value:N.includes(U.actionId),name:U.actionId,onValueChange:()=>{$({target:{value:U.actionId}})},disabled:I},U.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>K({target:{value:U.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(xe.Z,null)))))))})))};ae.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ae.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const We=ae,oe=({section:r,...c})=>{const[d,I]=(0,e.useState)(null),E=D=>I(D);return e.createElement(B.x,{padding:4,background:"neutral0"},r&&r.map((D,f)=>e.createElement(We,{key:D.apiId,label:D.label,controllers:D.controllers,orderNumber:f,indexExpandendCollapsedContent:d,onExpanded:E,name:D.apiId,...c})))};oe.defaultProps={section:null},oe.propTypes={section:n().arrayOf(n().object)};const Ne=oe,Ke=({...r})=>{const{value:{data:c}}=M(),{formatMessage:d}=(0,u.Z)();return e.createElement(F.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(Z.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h2"},d({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(k.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),c?.permissions&&e.createElement(Ne,{section:c?.permissions,...r})),e.createElement(Ie,null))},be=(0,e.memo)(Ke);var ie=t(51352);const Fe=(r,c=[])=>({...r,selectedAction:null,routes:[],selectedActions:[],data:(0,ie.mk)(c)});var $e=t(18172),He=t(97019),me=t.n(He);const Ve={data:{},selectedActions:[]},Ge=(r,c)=>(0,$e.ZP)(r,d=>{switch(c.type){case"ON_CHANGE":{d.selectedActions.includes(c.value)?me()(d.selectedActions,c.value):d.selectedActions.push(c.value);break}case"SELECT_ALL_IN_PERMISSION":{c.value.every(E=>d.selectedActions.includes(E.actionId))?c.value.forEach(E=>{me()(d.selectedActions,E.actionId)}):c.value.forEach(E=>{d.selectedActions.push(E.actionId)});break}case"SELECT_ALL_ACTIONS":{d.selectedActions=[...d.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=d.data.allActionsIds.filter(E=>E.includes("find")||E.includes("findOne"));d.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{d.data=(0,ie.mk)(c.value);break}case"UPDATE_ROUTES":{d.routes={...c.value};break}case"UPDATE_PERMISSIONS":{d.selectedActions=[...c.value];break}case"SET_SELECTED_ACTION":{d.selectedAction=c.value;break}default:return d}}),ze="Name already taken",Ye=()=>{(0,a.go)();const{formatMessage:r}=(0,u.Z)(),{lockApp:c,unlockApp:d}=(0,a.o1)(),I=(0,a.lm)(),E=(0,h.k6)(),D=(0,s.v9)(R._),[f,$]=(0,e.useState)(E.location.state?.apiToken.accessKey?{...E.location.state.apiToken}:null),{trackUsage:N}=(0,a.rS)(),K=(0,e.useRef)(N),{setCurrentStep:X}=(0,a.c1)(),{allowedActions:{canCreate:b,canUpdate:q,canRegenerate:le}}=(0,a.ss)(D.settings["api-tokens"]),[j,L]=(0,e.useReducer)(Ge,Ve,g=>Fe(g,{})),{params:{id:S}}=(0,h.$B)("/settings/api-tokens/:id"),{get:Q,post:re,put:U}=(0,a.kY)(),W=S==="create";(0,A.useQuery)("content-api-permissions",async()=>{const[g,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async J=>{const{data:x}=await Q(J);return x.data}));L({type:"UPDATE_PERMISSIONS_LAYOUT",value:g}),L({type:"UPDATE_ROUTES",value:G}),f&&(f?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),f?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),f?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:f?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{K.current(W?"didAddTokenFromList":"didEditTokenFromList",{tokenType:O.Z})},[W]);const{status:Xe}=(0,A.useQuery)(["api-token",S],async()=>{const{data:{data:g}}=await Q(`/admin/api-tokens/${S}`);return $({...g}),g?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),g?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),g?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:g?.permissions}),g},{enabled:!W&&!f,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),je=async(g,G)=>{K.current(W?"willCreateToken":"willEditToken",{tokenType:O.Z}),c();const J=g.lifespan&&parseInt(g.lifespan,10)&&g.lifespan!=="0"?parseInt(g.lifespan,10):null;try{const{data:{data:x}}=W?await re("/admin/api-tokens",{...g,lifespan:J,permissions:g.type==="custom"?j.selectedActions:null}):await U(`/admin/api-tokens/${S}`,{name:g.name,description:g.description,type:g.type,permissions:g.type==="custom"?j.selectedActions:null});W&&(E.replace(`/settings/api-tokens/${x.id}`,{apiToken:x}),X("apiTokens.success")),d(),$({...x}),I({type:"success",message:r(W?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),K.current(W?"didCreateToken":"didEditToken",{type:f.type,tokenType:O.Z})}catch(x){const pe=(0,C.Iz)(x.response.data);G.setErrors(pe),x?.response?.data?.error?.message===ze?I({type:"warning",message:x.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:x?.response?.data?.message||"notification.error"}),d()}},[Qe,ce]=(0,e.useState)(!1),Je={...j,onChange:({target:{value:g}})=>{ce(!0),L({type:"ON_CHANGE",value:g})},onChangeSelectAll:({target:{value:g}})=>{ce(!0),L({type:"SELECT_ALL_IN_PERMISSION",value:g})},setSelectedAction:({target:{value:g}})=>{L({type:"SET_SELECTED_ACTION",value:g})}},de=q&&!W||b&&W;return!W&&!f&&Xe!=="success"?e.createElement(he,{apiTokenName:f?.name}):e.createElement(P,{value:Je},e.createElement(p.o,null,e.createElement(a.SL,{name:"API Tokens"}),e.createElement(i.J9,{validationSchema:ie.fK,validateOnChange:!1,initialValues:{name:f?.name||"",description:f?.description||"",type:f?.type,lifespan:f?.lifespan?f.lifespan.toString():f?.lifespan},enableReinitialize:!0,onSubmit:(g,G)=>je(g,G)},({errors:g,handleChange:G,isSubmitting:J,values:x,setFieldValue:pe})=>(Qe&&x?.type!=="custom"&&pe("type","custom"),e.createElement(a.l0,null,e.createElement(H.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:f,setToken:$,canEditInputs:de,canRegenerate:le,isSubmitting:J,regenerateUrl:"/admin/api-tokens/"}),e.createElement(l.D,null,e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(f?.name)&&e.createElement(z.Z,{token:f?.accessKey,tokenType:O.Z}),e.createElement(Ee,{errors:g,onChange:G,canEditInputs:de,isCreating:W,values:x,apiToken:f,onDispatch:L,setHasChangedPermissions:ce}),e.createElement(be,{disabled:!de||x?.type==="read-only"||x?.type==="full-access"}))))))))}},51352:(T,m,t)=>{"use strict";t.d(m,{IX:()=>a,fK:()=>s,mk:()=>v});var e=t(6406),p=t(77349),l=t(51991);const a=(n,y,P="en")=>{if(y&&typeof y=="number"){const M=y/24/60/60/1e3;return(0,e.Z)((0,p.Z)(new Date(n),M),"PPP",{locale:l[P]})}return"Unlimited"};var i=t(1784),u=t(87561);const s=u.Ry().shape({name:u.Z_(i.I0.string).max(100).required(i.I0.required),type:u.Z_(i.I0.string).oneOf(["read-only","full-access","custom"]).required(i.I0.required),description:u.Z_().nullable(),lifespan:u.Rx().integer().min(0).nullable().defined(i.I0.required)}),v=n=>{const y={allActionsIds:[],permissions:[]};return y.permissions=Object.keys(n).map(P=>({apiId:P,label:P.split("::")[1],controllers:Object.keys(n[P].controllers).map(M=>({controller:M,actions:n[P].controllers[M].map(C=>{const R=`${P}.${M}.${C}`;return P.includes("api::")&&y.allActionsIds.push(R),{action:C,actionId:R}}).flat()})).flat()})),y}},41848:T=>{function m(t,e,p,l){for(var o=t.length,a=p+(l?1:-1);l?a--:++a<o;)if(e(t[a],a,t))return a;return-1}T.exports=m},42118:(T,m,t)=>{var e=t(41848),p=t(62722),l=t(42351);function o(a,i,u){return i===i?l(a,i,u):e(a,p,u)}T.exports=o},74221:T=>{function m(t,e,p,l){for(var o=p-1,a=t.length;++o<a;)if(l(t[o],e))return o;return-1}T.exports=m},62722:T=>{function m(t){return t!==t}T.exports=m},65464:(T,m,t)=>{var e=t(29932),p=t(42118),l=t(74221),o=t(7518),a=t(278),i=Array.prototype,u=i.splice;function A(s,h,v,n){var y=n?l:p,P=-1,M=h.length,C=s;for(s===h&&(h=a(h)),v&&(C=e(s,o(v)));++P<M;)for(var R=0,O=h[P],H=v?v(O):O;(R=y(C,H,R,n))>-1;)C!==s&&u.call(C,R,1),u.call(s,R,1);return s}T.exports=A},42351:T=>{function m(t,e,p){for(var l=p-1,o=t.length;++l<o;)if(t[l]===e)return l;return-1}T.exports=m},97019:(T,m,t)=>{var e=t(5976),p=t(45604),l=e(p);T.exports=l},45604:(T,m,t)=>{var e=t(65464);function p(l,o){return l&&l.length&&o&&o.length?e(l,o):l}T.exports=p},13217:(T,m,t)=>{var e=t(14259);function p(l){var o=l==null?0:l.length;return o?e(l,1,o):[]}T.exports=p}}]);
